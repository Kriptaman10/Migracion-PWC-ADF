<?xml version="1.0" encoding="UTF-8"?>
<POWERMART CREATION_DATE="2025-01-04" REPOSITORY_VERSION="10.5">
  <REPOSITORY NAME="REPO_TEST" VERSION="10.5" CODEPAGE="UTF-8">
    <FOLDER NAME="Test_Folder" GROUP="" OWNER="Admin">

      <!-- MAPPING: Mapping Simple de Prueba -->
      <MAPPING NAME="m_Test_Simple_v2" DESCRIPTION="Mapping de prueba para v2.0">

        <!-- SOURCE: Tabla de Ventas -->
        <SOURCE NAME="SQ_VENTAS" DATABASETYPE="Oracle" TABLENAME="VENTAS">
          <SOURCEFIELD NAME="ID_VENTA" DATATYPE="decimal" PRECISION="10" SCALE="0"/>
          <SOURCEFIELD NAME="PRODUCTO" DATATYPE="varchar2" PRECISION="50" SCALE="0"/>
          <SOURCEFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" SCALE="0"/>
          <SOURCEFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" SCALE="2"/>
          <SOURCEFIELD NAME="FECHA_VENTA" DATATYPE="date" PRECISION="29" SCALE="0"/>
        </SOURCE>

        <!-- SOURCE: Tabla de Productos -->
        <SOURCE NAME="SQ_PRODUCTOS" DATABASETYPE="Oracle" TABLENAME="PRODUCTOS">
          <SOURCEFIELD NAME="PRODUCTO_ID" DATATYPE="varchar2" PRECISION="50" SCALE="0"/>
          <SOURCEFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" SCALE="0"/>
          <SOURCEFIELD NAME="PRECIO_LISTA" DATATYPE="decimal" PRECISION="10" SCALE="2"/>
        </SOURCE>

        <!-- TARGET: Tabla de Resultado -->
        <TARGET NAME="TGT_RESUMEN_VENTAS" DATABASETYPE="Oracle" TABLENAME="RESUMEN_VENTAS">
          <TARGETFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" SCALE="0"/>
          <TARGETFIELD NAME="TOTAL_VENTAS" DATATYPE="decimal" PRECISION="15" SCALE="2"/>
          <TARGETFIELD NAME="CANTIDAD_TOTAL" DATATYPE="decimal" PRECISION="15" SCALE="0"/>
          <TARGETFIELD NAME="PROMEDIO_PRECIO" DATATYPE="decimal" PRECISION="10" SCALE="2"/>
          <TARGETFIELD NAME="FECHA_PROCESO" DATATYPE="date" PRECISION="29" SCALE="0"/>
        </TARGET>

        <!-- TRANSFORMATION: Source Qualifier para VENTAS -->
        <TRANSFORMATION NAME="SQ_VENTAS" TYPE="Source Qualifier">
          <TRANSFORMFIELD NAME="ID_VENTA" DATATYPE="decimal" PRECISION="10" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="PRODUCTO" DATATYPE="varchar2" PRECISION="50" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="FECHA_VENTA" DATATYPE="date" PRECISION="29" PORTTYPE="OUTPUT"/>
          <TABLEATTRIBUTE NAME="Source Filter" VALUE="FECHA_VENTA >= TO_DATE('2024-01-01', 'YYYY-MM-DD')"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Source Qualifier para PRODUCTOS -->
        <TRANSFORMATION NAME="SQ_PRODUCTOS" TYPE="Source Qualifier">
          <TRANSFORMFIELD NAME="PRODUCTO_ID" DATATYPE="varchar2" PRECISION="50" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" PORTTYPE="OUTPUT"/>
          <TRANSFORMFIELD NAME="PRECIO_LISTA" DATATYPE="decimal" PRECISION="10" PORTTYPE="OUTPUT"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Sorter para ordenar por producto -->
        <TRANSFORMATION NAME="SRT_POR_PRODUCTO" TYPE="Sorter">
          <TRANSFORMFIELD NAME="PRODUCTO" DATATYPE="varchar2" PRECISION="50" PORTTYPE="INPUT/OUTPUT" ISSORTKEY="YES" SORTDIRECTION="ASCENDING" SORTORDER="0"/>
          <TRANSFORMFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT" ISSORTKEY="NO"/>
          <TRANSFORMFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT" ISSORTKEY="NO"/>
          <TRANSFORMFIELD NAME="FECHA_VENTA" DATATYPE="date" PRECISION="29" PORTTYPE="INPUT/OUTPUT" ISSORTKEY="NO"/>
          <TABLEATTRIBUTE NAME="Distinct" VALUE="NO"/>
          <TABLEATTRIBUTE NAME="Case Sensitive" VALUE="YES"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Joiner para unir Ventas con Productos -->
        <TRANSFORMATION NAME="JNR_VENTAS_PRODUCTOS" TYPE="Joiner">
          <TRANSFORMFIELD NAME="PRODUCTO" DATATYPE="varchar2" PRECISION="50" PORTTYPE="INPUT/OUTPUT/MASTER"/>
          <TRANSFORMFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT/MASTER"/>
          <TRANSFORMFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT/MASTER"/>
          <TRANSFORMFIELD NAME="FECHA_VENTA" DATATYPE="date" PRECISION="29" PORTTYPE="INPUT/OUTPUT/MASTER"/>
          <TRANSFORMFIELD NAME="PRODUCTO_ID" DATATYPE="varchar2" PRECISION="50" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="PRECIO_LISTA" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT"/>
          <TABLEATTRIBUTE NAME="Join Condition" VALUE="PRODUCTO = PRODUCTO_ID"/>
          <TABLEATTRIBUTE NAME="Join Type" VALUE="Normal Join"/>
          <TABLEATTRIBUTE NAME="Sorted Input" VALUE="NO"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Expression para calcular total de venta -->
        <TRANSFORMATION NAME="EXP_CALCULAR_TOTAL" TYPE="Expression">
          <TRANSFORMFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="FECHA_VENTA" DATATYPE="date" PRECISION="29" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTA" DATATYPE="decimal" PRECISION="15"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="CANTIDAD * PRECIO"/>
          <TRANSFORMFIELD NAME="FECHA_PROCESO_STR" DATATYPE="varchar2" PRECISION="10"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="TO_CHAR(SYSDATE, 'YYYY-MM-DD')"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Aggregator para agrupar por categoría -->
        <TRANSFORMATION NAME="AGG_POR_CATEGORIA" TYPE="Aggregator">
          <TRANSFORMFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30"
                          PORTTYPE="INPUT/OUTPUT"
                          EXPRESSIONTYPE="GROUPBY"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTAS" DATATYPE="decimal" PRECISION="15"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="SUM(TOTAL_VENTA)"
                          EXPRESSIONTYPE="GENERAL"/>
          <TRANSFORMFIELD NAME="CANTIDAD_TOTAL" DATATYPE="decimal" PRECISION="15"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="SUM(CANTIDAD)"
                          EXPRESSIONTYPE="GENERAL"/>
          <TRANSFORMFIELD NAME="PROMEDIO_PRECIO" DATATYPE="decimal" PRECISION="10"
                          PORTTYPE="OUTPUT"
                          EXPRESSION="AVG(PRECIO)"
                          EXPRESSIONTYPE="GENERAL"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTA" DATATYPE="decimal" PRECISION="15" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="CANTIDAD" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT"/>
          <TABLEATTRIBUTE NAME="Sorted Input" VALUE="NO"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Router para separar categorías -->
        <TRANSFORMATION NAME="RTR_SEPARAR_CATEGORIAS" TYPE="Router">
          <GROUP NAME="INPUT" TYPE="INPUT"/>
          <GROUP NAME="CATEGORIA_ALTA" TYPE="OUTPUT" EXPRESSION="TOTAL_VENTAS &gt; 10000"/>
          <GROUP NAME="CATEGORIA_MEDIA" TYPE="OUTPUT" EXPRESSION="TOTAL_VENTAS &gt; 5000 AND TOTAL_VENTAS &lt;= 10000"/>
          <GROUP NAME="DEFAULT1" TYPE="OUTPUT/DEFAULT"/>
          <TRANSFORMFIELD NAME="CATEGORIA" GROUP="INPUT" DATATYPE="varchar2" PRECISION="30" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTAS" GROUP="INPUT" DATATYPE="decimal" PRECISION="15" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="CANTIDAD_TOTAL" GROUP="INPUT" DATATYPE="decimal" PRECISION="15" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="PROMEDIO_PRECIO" GROUP="INPUT" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT"/>
          <TRANSFORMFIELD NAME="CATEGORIA1" GROUP="CATEGORIA_ALTA" DATATYPE="varchar2" PRECISION="30" PORTTYPE="OUTPUT" REF_FIELD="CATEGORIA"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTAS1" GROUP="CATEGORIA_ALTA" DATATYPE="decimal" PRECISION="15" PORTTYPE="OUTPUT" REF_FIELD="TOTAL_VENTAS"/>
        </TRANSFORMATION>

        <!-- TRANSFORMATION: Update Strategy -->
        <TRANSFORMATION NAME="UPD_STRATEGY" TYPE="Update Strategy">
          <TRANSFORMFIELD NAME="CATEGORIA" DATATYPE="varchar2" PRECISION="30" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="TOTAL_VENTAS" DATATYPE="decimal" PRECISION="15" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="CANTIDAD_TOTAL" DATATYPE="decimal" PRECISION="15" PORTTYPE="INPUT/OUTPUT"/>
          <TRANSFORMFIELD NAME="PROMEDIO_PRECIO" DATATYPE="decimal" PRECISION="10" PORTTYPE="INPUT/OUTPUT"/>
          <TABLEATTRIBUTE NAME="Update Strategy Expression" VALUE="DD_INSERT"/>
        </TRANSFORMATION>

        <!-- CONNECTORS: Define el flujo de datos -->
        <CONNECTOR FROMFIELD="PRODUCTO" FROMINSTANCE="SQ_VENTAS" FROMINSTANCETYPE="Source Qualifier"
                   TOFIELD="PRODUCTO" TOINSTANCE="SRT_POR_PRODUCTO" TOINSTANCETYPE="Sorter"/>

        <CONNECTOR FROMFIELD="PRODUCTO" FROMINSTANCE="SRT_POR_PRODUCTO" FROMINSTANCETYPE="Sorter"
                   TOFIELD="PRODUCTO" TOINSTANCE="JNR_VENTAS_PRODUCTOS" TOINSTANCETYPE="Joiner"/>

        <CONNECTOR FROMFIELD="PRODUCTO_ID" FROMINSTANCE="SQ_PRODUCTOS" FROMINSTANCETYPE="Source Qualifier"
                   TOFIELD="PRODUCTO_ID" TOINSTANCE="JNR_VENTAS_PRODUCTOS" TOINSTANCETYPE="Joiner"/>

        <CONNECTOR FROMFIELD="CATEGORIA" FROMINSTANCE="JNR_VENTAS_PRODUCTOS" FROMINSTANCETYPE="Joiner"
                   TOFIELD="CATEGORIA" TOINSTANCE="EXP_CALCULAR_TOTAL" TOINSTANCETYPE="Expression"/>

        <CONNECTOR FROMFIELD="CATEGORIA" FROMINSTANCE="EXP_CALCULAR_TOTAL" FROMINSTANCETYPE="Expression"
                   TOFIELD="CATEGORIA" TOINSTANCE="AGG_POR_CATEGORIA" TOINSTANCETYPE="Aggregator"/>

        <CONNECTOR FROMFIELD="CATEGORIA" FROMINSTANCE="AGG_POR_CATEGORIA" FROMINSTANCETYPE="Aggregator"
                   TOFIELD="CATEGORIA" TOINSTANCE="RTR_SEPARAR_CATEGORIAS" TOINSTANCETYPE="Router"/>

        <CONNECTOR FROMFIELD="CATEGORIA1" FROMINSTANCE="RTR_SEPARAR_CATEGORIAS" FROMINSTANCETYPE="Router"
                   TOFIELD="CATEGORIA" TOINSTANCE="UPD_STRATEGY" TOINSTANCETYPE="Update Strategy"/>

        <CONNECTOR FROMFIELD="CATEGORIA" FROMINSTANCE="UPD_STRATEGY" FROMINSTANCETYPE="Update Strategy"
                   TOFIELD="CATEGORIA" TOINSTANCE="TGT_RESUMEN_VENTAS" TOINSTANCETYPE="Target Definition"/>

      </MAPPING>
    </FOLDER>
  </REPOSITORY>
</POWERMART>
